#!/bin/sh

if [ "$1" = "--help" ]; then
  echo "Usage: configure lua"
  echo "where 'lua' is the name of your Lua executable"
  exit 0
fi

echo "Trying to find where you installed Lua..."

if ! [ "$1" = "" ]; then
  lua=$1
else
  lua="lua"
fi

lua_root=$(dirname $(dirname $(which $lua)))

if [ "$lua_root" = "" ]; then
  echo "Lua not found, please install Lua (and put in your PATH)"
  exit 1
fi

lua_version=$($lua -v | sed -r 's|Lua ([0-9]\.[0-9])\..*|\1|I')

echo "Lua is in $lua_root"
echo "Writing config"
echo "LUA_DIR="$lua_root"/share/lua/"$lua_version > config
echo "BIN_DIR="$lua_root"/bin" >> config
echo "LUA_LIBDIR="$lua_root"/lib/lua/"$lua_version >> config
echo "Now run 'make && sudo make install'"

if [ -f ./wsapi/configure ]; then
  echo "Configuring wsapi..."
  cd wsapi
  ./configure $1
fi
